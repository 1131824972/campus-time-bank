import{s as p}from "./request-DJmCW_Ev.js";import{B as x}from "./BottomNav-EFK4FiqL.js";import{a as _,s as C}from "./function-call-6BMVRPF4.js";import{d as w,r as h,i as E,c as i,b as s,e as v,t as r,F as B,j as N,o as c,f as $,m as j,n as S,g as f,w as V}from "./index-BwHCGXaB.js";import{_ as z}from "./_plugin-vue_export-helper-DlAUqK2U.js";const D={class:"page-container mall-page"},F={class:"mall-header"},I={class:"balance-box"},M={class:"num-row"},L={class:"num"},T={class:"goods-grid"},q={class:"goods-img-wrapper"},A=["src","onError"],G={key:0,class:"sold-out-mask"},H={class:"shop-badge"},J={class:"goods-info"},K={class:"goods-title text-ellipsis"},O={class:"meta-row"},P={class:"action-row"},Q={class:"price"},R=w({__name:"Mall",setup(U){const m=h([]),d=h(0);E(()=>{g(),u()});const u=async()=>{try{const o=await p.get("/user/profile");d.value=o.balance}catch{}},g=async()=>{try{const o=await p.get("/mall/list");m.value=o}catch{}},b= o=>{if(d.value<o.price){_({title:"ä½™é¢ä¸è¶³",message:"æ‚¨çš„æ—¶é—´å¸ä¸è¶³ä»¥å…‘æ¢æ­¤å•†å“ï¼Œå¿«å»å¤§å…æ¥å•èµšé’±å§ï¼"});return}C({title:"ç¡®è®¤å…‘æ¢",message:`ç¡®è®¤æ¶ˆè€— ${o.price} æ—¶é—´å¸å…‘æ¢ "${o.name}" å—ï¼Ÿ`,confirmButtonColor:"#00C853",theme:"round-button"}).then(async()=>{try{const t=await p.post("/mall/exchange",{itemId:o.id});_({title:"ğŸ‰ å…‘æ¢æˆåŠŸ",message:`æ ¸é”€ç ï¼š${t}
è¯·æˆªå›¾ä¿å­˜ï¼Œå‡­æ­¤ç åˆ° [${o.shopName}] é¢†å–ã€‚`,confirmButtonColor:"#00C853"}),g(),u()}catch{}})},y=(o,t)=>{const n=o.target,e=t*137%360;if(n.style.display="none",n.parentElement){n.parentElement.style.background=`linear-gradient(135deg, hsl(${e}, 60%, 80%), hsl(${e+40}, 60%, 90%))`;const l=["ğŸ¥¤","ğŸŸï¸","âœï¸","ğŸ¥¯","ğŸ“¶","ğŸ’"],k=l[t%l.length]||"ğŸ",a=document.createElement("span");a.innerText=k,a.style.fontSize="40px",a.style.position="absolute",a.style.left="50%",a.style.top="50%",a.style.transform="translate(-50%, -50%)",n.parentElement.appendChild(a)}};return(o,t)=>{const n=$("van-button");return c(),i("div",D,[t[6]||(t[6]=s("div",{class:"mall-header-bg"},null,-1)),s("div",F,[t[2]||(t[2]=s("div",null,[s("h2",{class:"title"},"æƒç›Šå…‘æ¢"),s("p",{class:"subtitle"},"è®©æ¯ä¸€æ¬¡äº’åŠ©éƒ½æœ‰å›å“")],-1)),s("div",I,[t[1]||(t[1]=s("span",{class:"label"},"å¯ç”¨ä½™é¢",-1)),s("div",M,[t[0]||(t[0]=s("span",{class:"symbol"},"âŒ›",-1)),s("span",L,r(d.value.toFixed(1)),1)])])]),s("div",T,[(c(!0),i(B,null,N(m.value,e=>(c(),i("div",{key:e.id,class:"goods-card slide-up-item"},[s("div",q,[s("img",{src:e.image||"",class:"real-img",onError:l=>y(l,e.id),alt:"å•†å“å›¾ç‰‡"},null,40,A),e.stock<=0?(c(),i("div",G,[...t[3]||(t[3]=[s("span",null,"å·²æŠ¢å…‰",-1)])])):j("",!0),s("div",H,r(e.shopName),1)]),s("div",J,[s("h3",K,r(e.name),1),s("div",O,[s("span",{class:S(["stock-tag",{"low-stock":e.stock<10}])}," å‰©ä½™ "+r(e.stock),3)]),s("div",P,[s("div",Q,[t[4]||(t[4]=s("span",{class:"symbol"},"ğŸ’°",-1)),f(r(e.price),1)]),v(n,{size:"mini",round:"",disabled:e.stock<=0,class:"exchange-btn",onClick:l=>b(e)},{default:V(()=>[...t[5]||(t[5]=[f(" å…‘æ¢ ",-1)])]),_:1},8,["disabled","onClick"])])])]))),128))]),v(x)])}}}),ts=z(R,[["__scopeId","data-v-64bdb3b3"]]);export{ts as default};
